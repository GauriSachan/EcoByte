<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RepairHub</title>
    <!-- Use the Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
        }

        /* Custom glow effect */
        .glow-button {
            position: relative;
            z-index: 10;
        }

        .glow-button::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ff8c, #38d6a8, #f0fdf4, #00ff8c);
            background-size: 400%;
            border-radius: 12px;
            filter: blur(8px);
            opacity: 0.6;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .glow-button:hover::before {
            opacity: 1;
            animation: glowing 10s linear infinite;
        }

        @keyframes glowing {
            0% { background-position: 0 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0 50%; }
        }

        /* Hero section with image and overlay */
        .hero-bg-image {
            background-image: url('https://placehold.co/1920x1080/0d1117/1f2937?text=Tech+Repair');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .hero-bg-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(13, 17, 23, 0.85); /* Semi-transparent dark overlay */
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        /* Message Box Styling */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }

        /* Card hover animation */
        .card-animation:hover {
            box-shadow: 0 0 40px rgba(0, 255, 140, 0.3);
        }

        .table-container {
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <!-- Hero Section -->
    <section class="hero-bg-image py-24 md:py-32 relative overflow-hidden">
        <div class="hero-content container mx-auto px-4 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight mb-4 tracking-tight">
                Give Your Electronics a Second Life
            </h1>
            <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                Don't discard, repair! Our RepairHub connects you with experts to fix your gadgets and save valuable resources from landfills.
            </p>
            <a href="#repair-form" class="glow-button inline-block bg-emerald-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-emerald-600 transition-colors duration-300 transform hover:scale-105">
                Request a Repair Quote
            </a>
        </div>
    </section>

    <!-- Services Section -->
    <section class="py-20 bg-gray-900">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-white mb-12">Our Repair Services</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

                <!-- Service Card 1: Electronics -->
                <div class="card-animation bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700 hover:border-emerald-500 transition-all duration-300">
                    <div class="flex items-center justify-center w-16 h-16 bg-emerald-500 rounded-full mb-6">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L12 19.25L14.25 17m-4.5 0L7.5 19.25M9.75 17h4.5M12 4v4m0 0a4 4 0 11-4 4V8a4 4 0 014-4z"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Electronics Repair</h3>
                    <p class="text-gray-400">
                        From smartphones and laptops to gaming consoles, we diagnose and fix a wide range of electronic devices.
                    </p>
                </div>

                <!-- Service Card 2: Appliances -->
                <div class="card-animation bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700 hover:border-emerald-500 transition-all duration-300">
                    <div class="flex items-center justify-center w-16 h-16 bg-emerald-500 rounded-full mb-6">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18.5a6.5 6.5 0 100-13 6.5 6.5 0 000 13z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 1.5v2m0 17v2m-9.5-8.5h2m17 0h2m-15.5-8.5l1.414 1.414m-1.414 17l1.414-1.414m11.314-11.314l1.414-1.414m-1.414 17l1.414-1.414"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Home Appliances</h3>
                    <p class="text-gray-400">
                        Get your coffee makers, toasters, and other small home appliances running again with our expert repair services.
                    </p>
                </div>

                <!-- Service Card 3: Tools & More -->
                <div class="card-animation bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700 hover:border-emerald-500 transition-all duration-300">
                    <div class="flex items-center justify-center w-16 h-16 bg-emerald-500 rounded-full mb-6">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-3-3m3 3l-3 3m-4 2h8m0 0l-3-3m3 3l-3 3m-3 2h6m0 0l-3-3m3 3l-3 3"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Power Tools & Gadgets</h3>
                    <p class="text-gray-400">
                        From old power tools to quirky gadgets, our skilled technicians can often find a way to get them working again.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="py-20 bg-gray-900">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-white mb-12">How It Works</h2>
            <div class="flex flex-col md:flex-row justify-center items-center gap-12 text-center">

                <div class="flex-1 max-w-sm">
                    <div class="text-5xl text-emerald-500 mb-4 font-extrabold">1</div>
                    <h3 class="text-xl font-bold text-white mb-2">Submit Your Item</h3>
                    <p class="text-gray-400">Fill out our simple form with details about your broken item.</p>
                </div>

                <div class="hidden md:block w-16 border-b border-dashed border-gray-600"></div>

                <div class="flex-1 max-w-sm">
                    <div class="text-5xl text-emerald-500 mb-4 font-extrabold">2</div>
                    <h3 class="text-xl font-bold text-white mb-2">Get a Quote</h3>
                    <p class="text-gray-400">Our experts will review your request and provide a repair quote.</p>
                </div>

                <div class="hidden md:block w-16 border-b border-dashed border-gray-600"></div>

                <div class="flex-1 max-w-sm">
                    <div class="text-5xl text-emerald-500 mb-4 font-extrabold">3</div>
                    <h3 class="text-xl font-bold text-white mb-2">Bring it to Life</h3>
                    <p class="text-gray-400">Ship your item to us or drop it off and watch us work our magic!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Repair Request Form Section -->
    <section id="repair-form" class="py-20 bg-gray-900">
        <div class="container mx-auto px-4">
            <div class="max-w-xl mx-auto bg-gray-800 p-8 md:p-12 rounded-2xl shadow-2xl border border-gray-700">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-6 text-center">Request a Repair</h2>
                <form id="contact-form" class="space-y-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-300 mb-1">Your Name</label>
                        <input type="text" id="name" name="name" required class="w-full px-4 py-3 rounded-xl bg-gray-700 text-white placeholder-gray-500 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all duration-200">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-300 mb-1">Email Address</label>
                        <input type="email" id="email" name="email" required class="w-full px-4 py-3 rounded-xl bg-gray-700 text-white placeholder-gray-500 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all duration-200">
                    </div>
                    <div>
                        <label for="item" class="block text-sm font-medium text-gray-300 mb-1">Item to be Repaired</label>
                        <input type="text" id="item" name="item" required class="w-full px-4 py-3 rounded-xl bg-gray-700 text-white placeholder-gray-500 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all duration-200">
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-300 mb-1">Description of Issue</label>
                        <textarea id="description" name="description" rows="4" required class="w-full px-4 py-3 rounded-xl bg-gray-700 text-white placeholder-gray-500 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all duration-200"></textarea>
                    </div>
                    <div class="flex justify-center">
                        <button type="submit" class="glow-button w-full sm:w-auto bg-emerald-500 text-gray-900 font-bold py-3 px-8 rounded-xl hover:bg-emerald-600 transition-colors duration-300 transform hover:scale-105">
                            Submit Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- User and Request Tracking Section -->
    <section class="py-20 bg-gray-900">
        <div class="container mx-auto px-4">
            <div class="bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-6 text-center">My Repair Requests</h2>
                <div class="text-center mb-4 text-gray-400">
                    Your User ID: <span id="userIdDisplay" class="font-mono text-emerald-400 font-bold"></span>
                    <p class="text-sm mt-1">Use this ID to track your requests on any device.</p>
                </div>

                <div id="loading-requests" class="text-center py-10 text-gray-500 font-medium">
                    <svg class="animate-spin h-8 w-8 text-emerald-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-2">Loading requests...</p>
                </div>

                <!-- Request Table -->
                <div class="table-container">
                    <table class="w-full table-auto text-left">
                        <thead>
                            <tr class="bg-gray-700 text-gray-300 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Request ID</th>
                                <th class="py-3 px-6 text-left">Item</th>
                                <th class="py-3 px-6 text-left">Description</th>
                                <th class="py-3 px-6 text-left">Status</th>
                                <th class="py-3 px-6 text-left admin-only hidden">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTableBody" class="text-gray-400 text-sm font-light">
                            <!-- Requests will be populated here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Custom Message Box -->
    <div id="message-box" class="message-box p-6 rounded-2xl hidden" role="alert">
        <div class="text-center">
            <h3 id="message-title" class="text-xl font-bold mb-2 text-white"></h3>
            <p id="message-text" class="text-gray-400"></p>
            <button id="close-message" class="mt-4 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">Close</button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, setLogLevel, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Set Firebase debug log level
        setLogLevel('Debug');

        // Global variables for Firebase
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // UI Elements
        const form = document.getElementById('contact-form');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const closeButton = document.getElementById('close-message');
        const requestsTableBody = document.getElementById('requestsTableBody');
        const userIdDisplay = document.getElementById('userIdDisplay');
        const loadingSpinner = document.getElementById('loading-requests');

        const adminId = "admin-123"; // A hardcoded admin ID for demonstration

        let userId = null;
        let isAuthReady = false;

        // --- Authentication and Initialization ---
        const init = async () => {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Error signing in:", error);
                showMessageBox('Authentication Failed', 'There was an error logging you in. Please refresh the page.');
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                userIdDisplay.textContent = userId;
                if (userId === adminId) {
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
                }
                isAuthReady = true;
                listenForRequests();
            } else {
                console.log('User is signed out.');
                userId = null;
                isAuthReady = true;
            }
        });

        // --- Firestore Real-time Listener ---
        const listenForRequests = () => {
            if (!isAuthReady) return;

            const collectionPath = `/artifacts/${appId}/public/data/repair-requests`;
            const requestsRef = collection(db, collectionPath);

            onSnapshot(requestsRef, (snapshot) => {
                const requests = [];
                snapshot.forEach(doc => {
                    requests.push({ id: doc.id, ...doc.data() });
                });
                renderRequests(requests);
            }, (error) => {
                console.error("Error fetching requests:", error);
                loadingSpinner.innerHTML = '<p class="text-red-500">Failed to load requests.</p>';
            });
        };

        // --- Rendering Logic ---
        const renderRequests = (requests) => {
            requestsTableBody.innerHTML = '';
            loadingSpinner.classList.add('hidden');
            if (requests.length === 0) {
                requestsTableBody.innerHTML = '<tr><td colspan="5" class="py-4 text-center text-gray-500">No repair requests found.</td></tr>';
                return;
            }

            requests.sort((a, b) => b.createdAt?.toDate() - a.createdAt?.toDate());

            requests.forEach(request => {
                const isUserRequest = request.userId === userId;
                const statusColor = {
                    'Pending': 'bg-yellow-500',
                    'In Progress': 'bg-blue-500',
                    'Completed': 'bg-green-500',
                    'Canceled': 'bg-red-500'
                }[request.status] || 'bg-gray-500';

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800 transition-colors';
                row.innerHTML = `
                    <td class="py-4 px-6 font-mono text-xs">${request.id}</td>
                    <td class="py-4 px-6">${request.item}</td>
                    <td class="py-4 px-6">${request.description}</td>
                    <td class="py-4 px-6">
                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor} text-white">
                            ${request.status}
                        </span>
                    </td>
                    <td class="py-4 px-6 admin-only hidden">
                        <div class="flex space-x-2">
                            <button class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-semibold hover:bg-blue-700 update-status" data-id="${request.id}" data-status="In Progress">Start</button>
                            <button class="bg-green-600 text-white px-3 py-1 rounded-full text-xs font-semibold hover:bg-green-700 update-status" data-id="${request.id}" data-status="Completed">Complete</button>
                        </div>
                    </td>
                `;
                requestsTableBody.appendChild(row);
            });
            
            // Re-hide admin actions if not admin
            if (userId !== adminId) {
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
            }

            // Attach event listeners for admin actions
            document.querySelectorAll('.update-status').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const docId = e.target.dataset.id;
                    const newStatus = e.target.dataset.status;
                    const docRef = doc(db, `/artifacts/${appId}/public/data/repair-requests/${docId}`);
                    try {
                        await updateDoc(docRef, { status: newStatus });
                    } catch (error) {
                        console.error("Error updating status:", error);
                        showMessageBox('Error', 'Failed to update request status. Please try again.');
                    }
                });
            });
        };

        // --- Form Submission Logic ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) {
                showMessageBox('Please wait', 'Authentication is still in progress. Please try again in a moment.');
                return;
            }

            const formData = new FormData(form);
            const requestData = {
                userId: userId,
                name: formData.get('name'),
                email: formData.get('email'),
                item: formData.get('item'),
                description: formData.get('description'),
                status: 'Pending',
                createdAt: serverTimestamp()
            };

            try {
                const docRef = await addDoc(collection(db, `/artifacts/${appId}/public/data/repair-requests`), requestData);
                form.reset();
                showMessageBox('Request Submitted!', `Your request has been submitted successfully. Your ID is ${userId}.`);
                console.log("Document written with ID: ", docRef.id);
            } catch (error) {
                console.error("Error adding document: ", error);
                showMessageBox('Error', 'Failed to submit your request. Please try again.');
            }
        });

        // --- Message Box Helpers ---
        const showMessageBox = (title, text) => {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('bg-gray-800', 'shadow-2xl');
            document.body.classList.add('overflow-hidden');
        };

        closeButton.addEventListener('click', () => {
            messageBox.classList.add('hidden');
            messageBox.classList.remove('bg-gray-800', 'shadow-2xl');
            document.body.classList.remove('overflow-hidden');
        });

        // Start authentication process on load
        window.onload = init;
    </script>
</body>
</html>